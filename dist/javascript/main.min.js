var FluidL={Views:{},Models:{}};!function(app){"use strict";var EventsModel=function(){this.subscriptions={}};EventsModel.prototype={subscribe:function(eventName,callback){this.subscriptions[eventName]||(this.subscriptions[eventName]=[]),this.subscriptions[eventName].push(callback)},publish:function(eventName,data){this.subscriptions[eventName]&&this.subscriptions[eventName].forEach(function(callback){callback(data)})}},app.Models.EventsModel=EventsModel}(FluidL),function(app){"use strict";var StateModel=function(){this.options={statsItemName:"FluidL-stats",currentBoxesItemName:"FluidL-currentBoxes"},this.stats={nbrRemoved:0,removedBoxesIds:[]};var savedStats=localStorage.getItem(this.options.statsItemName);savedStats&&(this.stats=JSON.parse(localStorage.getItem(this.options.statsItemName))),this.currentBoxes=JSON.parse(localStorage.getItem(this.options.currentBoxesItemName))||[]};StateModel.prototype={hasSavedState:function(){return null!==localStorage.getItem(this.options.currentBoxesItemName)},getCurrentBoxes:function(){return this.currentBoxes},getStats:function(){return this.stats.nbrBoxes=this.currentBoxes.length,this.stats},getTotalBoxes:function(){return this.currentBoxes.length+this.stats.nbrRemoved},setCurrentBoxes:function(boxesData,toIndex){if(toIndex){var boxesBeforeIndex=this.currentBoxes.slice(0,toIndex);this.currentBoxes=boxesBeforeIndex.concat(boxesData)}else this.currentBoxes=boxesData;this.saveBoxes()},boxRemoved:function(boxId){this.stats.nbrRemoved++,this.stats.removedBoxesIds.push(boxId),this.saveStats()},reset:function(){this.currentBoxes=[],this.stats={nbrRemoved:0,removedBoxesIds:[]},this.saveBoxes(),this.saveStats()},saveBoxes:function(){localStorage.setItem(this.options.currentBoxesItemName,JSON.stringify(this.currentBoxes))},saveStats:function(){localStorage.setItem(this.options.statsItemName,JSON.stringify(this.stats))}},app.Models.StateModel=StateModel}(FluidL),function(app){"use strict";var CoreView=function(options){this.element=options.element||null,this.appEvents=options.appEvents||null};CoreView.prototype.getTemplate=function(){return""},CoreView.prototype.addEventListeners=function(){},CoreView.prototype.addListener=function(selector,eventName,callback){var cleanSelector=selector.substring(1);switch(selector.charAt(0)){case"#":this.addListenerById(cleanSelector,eventName,callback);break;case".":this.addListenerByClass(cleanSelector,eventName,callback)}},CoreView.prototype.addListenerById=function(elementId,eventName,callback){var element=document.getElementById(elementId);element&&element.addEventListener(eventName,function(){callback()},!1)},CoreView.prototype.addListenerByClass=function(className,eventName,callback){var elements=this.element.getElementsByClassName(className);if(elements.length)for(var nbrElements=elements.length,i=0;nbrElements>i;i++)elements[i].addEventListener(eventName,function(){callback()},!1)},app.Views.CoreView=CoreView}(FluidL),function(app){"use strict";var MainContainerView=function(options){app.Views.CoreView.call(this,options)};MainContainerView.prototype=Object.create(app.Views.CoreView.prototype),MainContainerView.prototype.addEventListeners=function(){this.appEvents.subscribe("box-over",this.handleBoxOver.bind(this)),this.appEvents.subscribe("box-out",this.handleBoxOut.bind(this))},MainContainerView.prototype.handleBoxOver=function(){this.element.style.border="10px solid black",this.element.style.padding="40px"},MainContainerView.prototype.handleBoxOut=function(){this.element.style.border="1px solid black",this.element.style.padding="50px"},app.Views.MainContainerView=MainContainerView}(FluidL),function(app){"use strict";var ContentView=function(options){app.Views.CoreView.call(this,options),this.appState=options.appState,this.boxes=[]};ContentView.prototype=Object.create(app.Views.CoreView.prototype),ContentView.prototype.initialize=function(){if(this.appState.hasSavedState())for(var currentBoxes=this.appState.getCurrentBoxes(),i=0;i<currentBoxes.length;i++)this.addBoxView(currentBoxes[i]);else this.initContent();this.setBgColor(-5*this.boxes.length),this.addEventListeners()},ContentView.prototype.addEventListeners=function(){this.appEvents.subscribe("box-over",this.handleBoxOver.bind(this)),this.appEvents.subscribe("box-out",this.handleBoxOut.bind(this)),this.appEvents.subscribe("box-removed",this.handleRemoveBoxView.bind(this)),this.appEvents.subscribe("box-added",this.handleAddingBoxView.bind(this)),this.appEvents.subscribe("reset-content",this.initContent.bind(this))},ContentView.prototype.handleBoxOver=function(){this.element.style.border="15px solid black",this.element.style.padding="35px 35px 25px 35px"},ContentView.prototype.handleBoxOut=function(){this.element.style.padding="50px 50px 40px 50px",this.element.style.border="1px solid black"},ContentView.prototype.handleRemoveBoxView=function(data){this.boxes.splice(data.boxIndex,1),this.updateBoxesFromIndex(data.boxIndex-1),this.setBgColor(5),this.appState.boxRemoved(data.boxId)},ContentView.prototype.handleAddingBoxView=function(boxIndex){this.addBoxViewOnIndex(boxIndex),this.setBgColor(-5)},ContentView.prototype.initContent=function(){if(this.boxes.length){for(var i=0;i<this.boxes.length;i++)this.boxes[i].element.remove();this.boxes=[]}this.addBoxViewOnIndex(0),this.appState.setCurrentBoxes([this.boxes[0].getData()])},ContentView.prototype.addBoxView=function(boxData){var boxIndex=this.validateBoxIndex(boxData.index);boxData.appEvents=this.appEvents;var boxView=new app.Views.BoxView(boxData);this.boxes.splice(boxIndex,0,boxView),this.drawBoxView(boxView,!0)},ContentView.prototype.addBoxViewOnIndex=function(index){var boxIndex=this.validateBoxIndex(index),boxView=new app.Views.BoxView({id:this.appState.getTotalBoxes()+1,appEvents:this.appEvents});this.boxes.splice(boxIndex,0,boxView);var isLast=this.boxes.length-1===boxIndex;this.initBoxView(boxView,boxIndex,isLast),this.drawBoxView(boxView),this.updateBoxesFromIndex(boxIndex-1)},ContentView.prototype.drawBoxView=function(boxView,append){var newBoxTemplate=boxView.getTemplate();boxView.isLast||append?this.element.appendChild(newBoxTemplate):this.element.insertBefore(newBoxTemplate,this.boxes[boxView.index+1].element),boxView.addEventListeners()},ContentView.prototype.initBoxView=function(boxView,boxIndex,isLast){var gridRow=this.calculateGridRow(boxIndex);boxView.init({index:boxIndex,gridRow:gridRow,prevBox:this.getPrevBoxId(boxIndex,gridRow),nextBox:this.getNextBoxId(boxIndex,gridRow),isLast:isLast||!1})},ContentView.prototype.calculateGridRow=function(boxIndex){var gridRowNumber=1,gridSegment=(boxIndex+1)%6;switch(gridSegment){case 0:gridRowNumber=3;break;case 4:case 5:gridRowNumber=2}return gridRowNumber},ContentView.prototype.getPrevBoxId=function(boxIndex,gridRow){var prevBoxId=null,prevIndex=boxIndex-1;if(prevIndex>=0){var prevBoxRow=this.calculateGridRow(prevIndex);prevBoxRow===gridRow&&(prevBoxId=this.boxes[prevIndex].getId())}return prevBoxId},ContentView.prototype.getNextBoxId=function(boxIndex,gridRow){var nextBoxId=null,nextIndex=boxIndex+1;if(nextIndex<this.boxes.length){var nextBoxRow=this.calculateGridRow(nextIndex);nextBoxRow===gridRow&&(nextBoxId=this.boxes[nextIndex].getId())}return nextBoxId},ContentView.prototype.validateBoxIndex=function(index){var boxIndex=this.boxes.length;return"undefined"!=typeof index&&(boxIndex=index>boxIndex?boxIndex:parseInt(index,10)),boxIndex},ContentView.prototype.updateBoxesFromIndex=function(index){var nbrBoxes=this.boxes.length;index=0>index?0:index;for(var boxesData=[],i=index;nbrBoxes>i;i++){var curBox=this.boxes[i],isLast=i===nbrBoxes-1;this.initBoxView(curBox,i,isLast),curBox.updateTemplate(),boxesData.push(curBox.getData())}this.appState.setCurrentBoxes(boxesData,index)},ContentView.prototype.setBgColor=function(shadeAdjustment){var defaultShade=220,bgColor=window.getComputedStyle(this.element).backgroundColor,shade=parseInt(bgColor.split(",")[1])||defaultShade,newShade=shade+shadeAdjustment;this.element.style.backgroundColor="rgba("+newShade+","+newShade+","+newShade+", 0.8)"},app.Views.ContentView=ContentView}(FluidL),function(app){"use strict";var BoxView=function(options){app.Views.CoreView.call(this,options),this.id=options.id,this.index=0,this.gridRow=null,this.prevBox=null,this.nextBox=null,this.isLast=!1,this.init(options)};BoxView.prototype=Object.create(app.Views.CoreView.prototype),BoxView.prototype.addEventListeners=function(){this.addListener(".box","mouseenter",this.handleBoxOver.bind(this)),this.addListener(".box","mouseleave",this.handleBoxOut.bind(this)),this.addListener(".box","click",this.addNewBox.bind(this)),this.addListener(".js-box-remove","click",this.removeSelf.bind(this))},BoxView.prototype.init=function(options){this.index=options.index||0,this.gridRow=options.gridRow||null,this.prevBox=options.prevBox||null,this.nextBox=options.nextBox||null,this.isLast=options.isLast||!1},BoxView.prototype.handleBoxOver=function(){this.appEvents.publish("box-over")},BoxView.prototype.handleBoxOut=function(){this.appEvents.publish("box-out")},BoxView.prototype.getId=function(){return this.id},BoxView.prototype.getTemplate=function(){var boxWrapper=document.createElement("div");this.setupBoxWrapperTpl(boxWrapper);var box=document.createElement("div");this.setupBoxTpl(box);var boxHeader=document.createElement("div");this.setupBoxHeaderTpl(boxHeader);var boxContent=document.createElement("div");return this.setupBoxContentTpl(boxContent),box.appendChild(boxHeader),box.appendChild(boxContent),boxWrapper.appendChild(box),this.element=boxWrapper,boxWrapper},BoxView.prototype.updateTemplate=function(){this.setupBoxWrapperTpl(this.element);var box=this.element.getElementsByClassName("box")[0];this.setupBoxTpl(box);var boxContent=box.getElementsByClassName("box-content")[0];this.setupBoxContentTpl(boxContent)},BoxView.prototype.removeSelf=function(){this.appEvents.publish("box-removed",{boxIndex:this.index,boxId:this.id}),this.appEvents.publish("box-out"),this.element.remove()},BoxView.prototype.addNewBox=function(){this.appEvents.publish("box-added",this.index+1)},BoxView.prototype.getGridRowClass=function(){var giClass="col-2-6";switch(this.gridRow){case 2:giClass="col-3-6";break;case 3:giClass="col-6-6"}return giClass},BoxView.prototype.getBoxIndexBgColor=function(){var bgColor="";switch((this.index+1)%4){case 2:bgColor="#cc3300";break;case 3:bgColor="#2F9039";break;case 0:bgColor="#5189AD"}return bgColor},BoxView.prototype.getData=function(){return{id:this.id,index:this.index,gridRow:this.gridRow,prevBox:this.prevBox,nextBox:this.nextBox,isLast:this.isLast}},BoxView.prototype.setupBoxWrapperTpl=function(boxWrapper){var gridRowClass=this.getGridRowClass();boxWrapper.className="box-wrapper "+gridRowClass},BoxView.prototype.setupBoxTpl=function(box){var lastBoxClass=this.isLast?" last":"";box.className="box"+lastBoxClass;var bgColor=this.getBoxIndexBgColor();box.style.backgroundColor=bgColor},BoxView.prototype.setupBoxHeaderTpl=function(boxHeader){boxHeader.className="box-header",boxHeader.innerHTML='<div class="box-section f-left box-header-info">['+this.id+']</div><div class="box-section f-right box-header-actions"><button class="js-box-remove" onclick="javascript:event.stopPropagation();">X</button></div>'},BoxView.prototype.setupBoxContentTpl=function(boxContent){var prevBox=null===this.prevBox?"":this.prevBox,nextBox=null===this.nextBox?"":this.nextBox;boxContent.className="box-content",boxContent.innerHTML='<div class="box-section f-left">'+prevBox+'</div><div class="box-section f-right">'+nextBox+"</div>"},app.Views.BoxView=BoxView}(FluidL),function(app){"use strict";var AppInfoView=function(options){app.Views.CoreView.call(this,options),this.msgTimeout=null,this.appState=options.appState};AppInfoView.prototype=Object.create(app.Views.CoreView.prototype),AppInfoView.prototype.addEventListeners=function(){this.appEvents.subscribe("box-added",this.handleBoxAdded.bind(this)),this.appEvents.subscribe("box-removed",this.handleBoxRemoved.bind(this)),this.addListener(".js-reset","click",this.handleResetContent.bind(this))},AppInfoView.prototype.initialize=function(){this.showCurrentStats(),this.addEventListeners()},AppInfoView.prototype.handleBoxAdded=function(boxIndex){this.showCurrentStats();var currentBoxes=this.appState.getCurrentBoxes(),boxId=currentBoxes[boxIndex].id;this.showMessage("Box ["+boxId+"] added on position "+(boxIndex+1))},AppInfoView.prototype.handleBoxRemoved=function(data){this.showCurrentStats(),this.showMessage("Box ["+data.boxId+"] removed from position "+(data.boxIndex+1))},AppInfoView.prototype.handleResetContent=function(){this.appState.reset(),this.appEvents.publish("reset-content"),this.showCurrentStats(),this.showMessage("Boxes re-initialized")},AppInfoView.prototype.showCurrentStats=function(){var stats=this.appState.getStats(),nbrBoxesInfo=document.getElementById("nbr-boxes-info"),nbrRemovedInfo=document.getElementById("nbr-removed-boxes-info");nbrBoxesInfo.innerHTML=stats.nbrBoxes,nbrRemovedInfo.innerHTML=stats.nbrRemoved,nbrRemovedInfo.title=stats.removedBoxesIds.join(", ")},AppInfoView.prototype.showMessage=function(msg){var msgInfo=document.getElementById("actions-info-msg");msgInfo.innerHTML=msg,clearTimeout(this.msgTimeout),this.msgTimeout=setTimeout(function(){msgInfo.innerHTML=""},3e3)},app.Views.AppInfoView=AppInfoView}(FluidL),function(app){"use strict";var appEvents=new app.Models.EventsModel,appState=new app.Models.StateModel,mainContainerView=new app.Views.MainContainerView({element:document.getElementsByClassName("main-container")[0],appEvents:appEvents});mainContainerView.addEventListeners();var contentView=new app.Views.ContentView({element:document.getElementsByClassName("content")[0],appEvents:appEvents,appState:appState});contentView.initialize();var appInfoView=new app.Views.AppInfoView({element:document.getElementsByClassName("app-info-box")[0],appEvents:appEvents,appState:appState});appInfoView.initialize()}(FluidL);